
<!DOCTYPE html>
<html lang="en">

<!-- Head -->
<head>

        <!-- Required metadata tags -->
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="HandheldFriendly" content="True" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- Default metadata -->
    <meta name="author" content="vdmitriyev" />
    <meta name="description" content="" />
    <meta name="keywords" content="hadoop, streaming, xml, bigdata, python">
<meta property="og:site_name" content="Viktor's blog" />
<meta property="og:title" content="Hadoop Streaming and XML with Python" />
<meta property="og:description" content="" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="./hadoop-streaming-and-xml-with-python.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-03-03 18:00:00+01:00" />
<meta property="article:modified_time" content="" />
<meta property="article:author" content="./author/vdmitriyev.html">
<meta property="article:section" content="interesting" />
	<meta property="article:tag" content="hadoop" />
	<meta property="article:tag" content="streaming" />
	<meta property="article:tag" content="xml" />
	<meta property="article:tag" content="bigdata" />
	<meta property="article:tag" content="python" />
	<meta property="og:image" content="./">

        <!-- Site Claim -->


        <!-- Title -->
        <title>
    Hadoop Streaming and XML with Python &ndash; Viktor's blog
        </title>
        
        <!-- Icon -->
        <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
        <link rel="icon" href="./favicon.ico" type="image/x-icon">

        <!-- Search engine -->
            <meta name="robots" content="" />

        <!-- Feeds -->








        <!-- Styles -->
        <!--
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/css/bootstrap.min.css">
        -->
        <link rel="stylesheet" href="./theme/bootstrap/bootstrap.min.css">
        <!--
        <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css">
        -->
        <link rel="stylesheet" href="./theme/pygment/friendly.min.css">
        <!--
        <link rel="stylesheet" href="./theme/extra/admonition.min.css">
        -->
        <link rel="stylesheet" href="./theme/style.css">

        <!-- Google Analytics -->
<script>
(function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date();
    a = s.createElement(o), m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m) })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-59176821-3', 'auto');
ga('send', 'pageview');
</script>
        <!-- Google Global Site Tag -->

        <!-- Google Tag Manager -->

        <!-- Google Adsense -->

        <!-- Heap Analytic -->

        <!-- Piwik Tracking -->

        <!-- Matomo Tracking -->

</head>

<!-- Body -->
<body class="d-flex flex-column" data-spy="scroll" data-target="#toc" data-offset="0" style="position: relative;">
    <!-- Top anchor -->
    <a href="#" id="backToTop" style="display: none; z-index: 1;" title="Back to top"><span></span></a>

    <!-- Google tag manager -->

    <!-- Navigation -->
    <nav class="flex-shrink-0 navbar navbar-expand-md navbar-expand-lg navbar-dark bg-dark text-light shadow-sm">
        <!-- Logo -->
        <a class="navbar-brand" href="."></a>

        <!-- Collapse button -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMenu" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon small"></span>
        </button>

        <!-- Collapsible content -->
        <div class="collapse navbar-collapse" id="navbarMenu">

            <!-- i18n subsites -->

            <!-- Page links -->
            <ul class="navbar-nav mr-auto text-center">
                <li class="nav-item ">                           
                    <a class="nav-link" href=".">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M21 13v10h-6v-6h-6v6h-6v-10h-3l12-12 12 12h-3zm-1-5.907v-5.093h-3v2.093l3 3z" fill="currentColor"></path>
                        </svg>
                        Home <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="./categories.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M16 6h-8v-6h8v6zm-8 12h-8v6h8v-6zm16 0h-8v6h8v-6zm-11-7v-3h-2v3h-8v5h2v-3h14v3h2v-5h-8z" fill="currentColor"></path>
                        </svg>
                        Categories
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="./tags.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M10.605 0h-10.605v10.609l13.391 13.391 10.609-10.604-13.395-13.396zm-4.191 6.414c-.781.781-2.046.781-2.829.001-.781-.783-.781-2.048 0-2.829.782-.782 2.048-.781 2.829-.001.782.782.781 2.047 0 2.829z" fill="currentColor"></path>
                        </svg>
                        Tags
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="./archives.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M1.8 9l-.8-4h22l-.8 4h-2.029l.39-2h-17.122l.414 2h-2.053zm18.575-6l.604-2h-17.979l.688 2h16.687zm3.625 8l-2 13h-20l-2-13h24zm-8 4c0-.552-.447-1-1-1h-6c-.553 0-1 .448-1 1s.447 1 1 1h6c.553 0 1-.448 1-1z" fill="currentColor"></path>
                        </svg>
                        Archives
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="./pages/about.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M20.822 18.096c-3.439-.794-6.64-1.49-5.09-4.418 4.72-8.912 1.251-13.678-3.732-13.678-5.082 0-8.464 4.949-3.732 13.678 1.597 2.945-1.725 3.641-5.09 4.418-3.073.71-3.188 2.236-3.178 4.904l.004 1h23.99l.004-.969c.012-2.688-.092-4.222-3.176-4.935z" fill="currentColor"></path>
                        </svg>
                        About
                    </a>
                </li>
            </ul>

            <!-- Search form -->
            <form class="form-inline text-center" action="./search.html">
                <input class="form-control w-100 bg-dark text-light text-center border-0 p-2" type="text" name="q" pattern=".{3,}" title="At least 3 characters" required="" placeholder="Type here to search" aria-label="Search">
            </form>

            <!-- Social links -->
            <ul class="navbar-nav text-center">
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>Facebook</title>
                            <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3 8h-1.35c-.538 0-.65.221-.65.778v1.222h2l-.209 2h-1.791v7h-3v-7h-2v-2h2v-2.308c0-1.769.931-2.692 3.029-2.692h1.971v3z" fill="currentColor"></path>
                        </svg>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/vdmitriyev">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>Github</title>
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" fill="currentColor"></path>
                        </svg>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>Linkedin</title>
                            <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-2 16h-2v-6h2v6zm-1-6.891c-.607 0-1.1-.496-1.1-1.109 0-.612.492-1.109 1.1-1.109s1.1.497 1.1 1.109c0 .613-.493 1.109-1.1 1.109zm8 6.891h-1.998v-2.861c0-1.881-2.002-1.722-2.002 0v2.861h-2v-6h2v1.093c.872-1.616 4-1.736 4 1.548v3.359z" fill="currentColor"></path>
                        </svg>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://twitter.com/vdmitriyev">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>Twitter</title>
                            <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z" fill="currentColor"></path>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Full page -->
    <div class="flex-shrink-0 flex-grow-1">

        <!-- Header -->
        <header class="bg-dark text-light shadow-sm pt-3 pb-2">
	<div class="container">
		<h3 id="hadoop-streaming-and-xml-with-python">Hadoop Streaming and XML with Python</h3>
		<p style="font-size:larger;"></p>
        <div class="row mx-auto mt-3">
            <div class="col-xs-12 col-sm-12 col-md-6 text-left" style="padding: 0">
                <a href="./author/vdmitriyev.html" class="card-link">vdmitriyev</a>
                <span class="card-link text-success">
                    <span class="post-date" title="Post date">March 2016</span>
                    <span class="text-info modified-date" title="Updated date">
                            March 2016
                    </span>
                </span>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-6 text-right" style="padding: 0">
                <a class="badge badge-success" href="./category/interesting.html">interesting</a>
                    <a class="badge badge-info" href="./tag/hadoop.html">hadoop</a>
                    <a class="badge badge-info" href="./tag/streaming.html">streaming</a>
                    <a class="badge badge-info" href="./tag/xml.html">xml</a>
                    <a class="badge badge-info" href="./tag/bigdata.html">bigdata</a>
                    <a class="badge badge-info" href="./tag/python.html">python</a>
            </div>
        </div>
	</div>
        </header>

        <!-- Main -->
        <main class="py-3">
                <div class="container">
                    <!-- Sharing -->

                    <!-- Content -->
    <!-- 2 columns layout -->
    <!-- single column layout -->
        <!-- Sharing -->

        <!-- Share post -->

        <!-- Article -->
        <div>
            <p><center>
    <img alt="Hadoop Streaming and XML with Python" src="./images/random/hadoop-streaming.png">
</center></p>
<p>The general idea behind current post is to show how parsing of single XML file with Python script could be implemented with Hadoop Streaming.</p>
<p>Trying <a href="https://hadoop.apache.org/docs/r1.2.1/streaming.html#Hadoop+Streaming">Hadoop Streaming</a> on Hortonworks Virtual Machine (VM) image (HDP version is 2.3.1). For streaming XML use following <a href="http://www.science.smith.edu/dftwiki/index.php/Hadoop_Tutorial_2.1_--_Streaming_XML_Files">Hadoop Tutorial 2.1 -- Streaming XML Files</a> article. All discussed Python scripts and XML data samples can be found at the end of current document in <strong>Scripts and Files</strong> section.</p>
<p>In case you have your own Hadoop installation and you are accessing machine via your own user and you are having exceptions with 'Permission denied:' it's better if you will start streaming jobs under the name of <code>hdfs</code> user. In Ubuntu you can switch to <code>hdfs</code> user with command <code>sudo su hdfs -</code>.</p>
<h3>Loading Data</h3>
<p>Loading data (don't forget to copy that to Hadoop machine locally). If you are running your virtual machine on Windows host than propably you will find <a href="https://winscp.net/eng/download.php">WinSCP</a> useful.</p>
<div class="highlight"><pre><span></span><code>hdfs<span class="w"> </span>dfs<span class="w"> </span>-mkdir<span class="w"> </span>/data/xml/inputs/
hdfs<span class="w"> </span>dfs<span class="w"> </span>-put<span class="w"> </span>/root/streaming/samplexml01.xml<span class="w"> </span>/data/xml/inputs/
</code></pre></div>

<p>Don't forget to copy Python scripts used within map-reduce phases on VM machine (where all commands are executed).</p>
<h3>Prerequisites (CentOS)</h3>
<p>You will need to use <code>dos2unix</code> utility on your Hortonworks VM only in case your host machine is Windows.</p>
<div class="highlight"><pre><span></span><code>yum<span class="w"> </span>install<span class="w"> </span>dos2unix
</code></pre></div>

<h3>Simple Option with XML</h3>
<p>Note Hadoop location for Hortonworks image is <code>/usr/hdp/current</code>.
Try simplest option of streaming with default linux commands.</p>
<div class="highlight"><pre><span></span><code>hadoop<span class="w"> </span>jar<span class="w"> </span>/usr/hdp/current/hadoop-mapreduce-client/hadoop-streaming.jar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-input<span class="w"> </span>/data/xml/inputs/<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-output<span class="w"> </span>/data/xml/outputs/01/<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-mapper<span class="w"> </span>/bin/cat<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-reducer<span class="w"> </span>/usr/bin/wc
</code></pre></div>

<p>Try simplest option of streaming with default linux commands and XML reader. Don't forget to remove previous output from HDFS, otherwise the MapReduce will thrown exception during execution (it cannot write it's output into existing directory).</p>
<div class="highlight"><pre><span></span><code>hadoop<span class="w"> </span>jar<span class="w"> </span>/usr/hdp/current/hadoop-mapreduce-client/hadoop-streaming.jar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-inputreader<span class="w"> </span><span class="s2">&quot;StreamXmlRecordReader,begin=xmlroot,end=/xmlroot&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-input<span class="w"> </span>/data/xml/inputs/<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-output<span class="w"> </span>/data/xml/outputs/02/<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-mapper<span class="w"> </span>/bin/cat<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-reducer<span class="w"> </span>/usr/bin/wc
</code></pre></div>

<p>Please note that the common problem for errors is that Hadoop is not running streaming when output folder exists.</p>
<h3>Python and XML</h3>
<p>Preparing Python scripts. Note that it other to make Python work on linux from command line directly (without explicitly calling <code>python</code> you need to use proper headline as the first line of your Python script).</p>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>a+x<span class="w"> </span>./mapper.py
chmod<span class="w"> </span>a+x<span class="w"> </span>./reducer.py
</code></pre></div>

<p>In case your host system is Windows and guest is Linux, you need to convert between Windows and Linux file formats.</p>
<div class="highlight"><pre><span></span><code>dos2unix<span class="w"> </span>mapper.py
dos2unix<span class="w"> </span>reducer.py
</code></pre></div>

<p>Local testing facilities... Running simple testing locally, which will allows you to test your script without "heavy" MapReduce.</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span>samplexml01.xml<span class="w"> </span><span class="p">|</span><span class="w"> </span>./mapper.py<span class="w"> </span><span class="p">|</span><span class="w"> </span>./reducer.py
</code></pre></div>

<h3>Hadoop Cluster, Python and XML</h3>
<p>Run Python scripts inside Hadoop cluster.</p>
<div class="highlight"><pre><span></span><code>hadoop<span class="w"> </span>jar<span class="w"> </span>/usr/hdp/current/hadoop-mapreduce-client/hadoop-streaming.jar<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-input<span class="w"> </span>/data/xml/inputs/<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-output<span class="w"> </span>/data/xml/outputs/04/<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-file<span class="w"> </span>mapper.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-file<span class="w"> </span>reducer.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-mapper<span class="w"> </span>./mapper.py<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-reducer<span class="w"> </span>./reducer.py
</code></pre></div>

<h3>Monitoring Resources of the Hortonworks VM</h3>
<ul>
<li><a href="http://localhost:8088/cluster">http://localhost:8088/cluster</a></li>
<li><a href="http://localhost:50070/dfshealth.html#tab-overview">http://localhost:50070/dfshealth.html#tab-overview</a></li>
<li><a href="http://localhost:8000/filebrowser/view/data/xml/outputs">http://localhost:8000/filebrowser/view/data/xml/outputs</a></li>
<li><a href="http://localhost:8080/#/main/dashboard/metrics">http://localhost:8080/#/main/dashboard/metrics</a></li>
</ul>
<p></br></p>
<h2>Scripts and Files</h2>
<p>Simpler mapper (version 1)</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="k">as</span> <span class="n">defaultdict</span>

<span class="c1"># some constants for local debugging</span>
<span class="n">_input_file</span> <span class="o">=</span> <span class="s1">&#39;input.txt&#39;</span>
<span class="n">_output_file</span> <span class="o">=</span> <span class="s1">&#39;output.txt&#39;</span>

<span class="k">def</span> <span class="nf">_mapper</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Mapper that iterates through particular tags of XML file.&quot;&quot;&quot;</span>

    <span class="n">inText</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">currentTag</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ticketsection&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1">#print &#39;[i] start copying&#39;</span>
                <span class="n">inText</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">currentTag</span> <span class="o">=</span> <span class="n">tag</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;/&#39;</span> <span class="o">+</span> <span class="n">tag</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1">#print &#39;[i] stop copying&#39;</span>
                <span class="n">inText</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">currentTag</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">inText</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">currentTag</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Running scripts methods &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">_input_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">_output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

    <span class="n">_mapper</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#run(True)</span>
    <span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>Simpler reducer</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="k">as</span> <span class="n">defaultdict</span>

<span class="c1"># some constants for local debugging</span>
<span class="n">_input_file</span> <span class="o">=</span> <span class="s1">&#39;input.txt&#39;</span>
<span class="n">_output_file</span> <span class="o">=</span> <span class="s1">&#39;output.txt&#39;</span>

<span class="k">def</span> <span class="nf">_reducer</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Reducer that iterates through provided input and just prints it.&quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">tag</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">:</span><span class="se">\t</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Running scripts methods &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">_input_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">_output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

    <span class="n">_reducer</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#run(True)</span>
    <span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>File samplexml01.xml to be used by scripts</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;xmlroot</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;pather</span><span class="w"> </span><span class="na">guid=</span><span class="s">&quot;00011a0330-432432-4324-434324-4324353245sfds&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;ticketsection&gt;</span>
<span class="w">       </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;EN&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DefaultLanguage&quot;</span><span class="nt">/&gt;</span>
<span class="w">       </span><span class="nt">&lt;attribute</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;New Value&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;SomeValues&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/ticketsection&gt;</span>
<span class="w">  </span><span class="nt">&lt;/pather&gt;</span>
<span class="nt">&lt;/xmlroot&gt;</span>
</code></pre></div>

<p>Simpler mapper (version 2)</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="k">as</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>

<span class="kn">import</span> <span class="nn">uuid</span>  <span class="c1"># added</span>

<span class="c1"># some constants for local debugging</span>
<span class="n">_input_file</span> <span class="o">=</span> <span class="s1">&#39;input.txt&#39;</span>
<span class="n">_output_file</span> <span class="o">=</span> <span class="s1">&#39;output.txt&#39;</span>

<span class="k">def</span> <span class="nf">_mapper</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Mapper that reads whole XML file and sends it to Reducer.&quot;&quot;&quot;</span>

    <span class="n">xml</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">unique_key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">get_hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">xml</span> <span class="o">+=</span> <span class="n">line</span> <span class="c1">#+ &#39;\n&#39;</span>

    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_key</span><span class="p">,</span> <span class="n">xml</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">root</span><span class="p">)))</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="se">\t</span><span class="s1">[e]</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">from_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Running scripts methods &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">from_file</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">_input_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">_output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

    <span class="n">_mapper</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">#run(True)</span>
    <span class="n">run</span><span class="p">()</span>
</code></pre></div>
        </div>

        <!-- Neighbors -->
            <br>
            <b>Read more:</b><br>
<div class="pagination">
    <a class="w-50" href="./how-to-motivate-people-in-creating-maintaining-datasets.html">
&ll; How to Motivate People in Creating, Maintaining Datasets
    </a>
    <a class="w-50 text-right" href="./online-materials-on-in-memory-computing.html">
        Online Materials on In-Memory Computing &gg;    </a>
</div>
        <!-- Google Adsense -->

    <!-- Releated posts -->

    <!-- Comments -->
                </div>
        </main>

    </div>

    <!-- Footer -->
    <footer class="flex-shrink-0 bg-dark text-light small py-1">
        <div class="container text-center">
            &copy; 2024 <a href=".">Viktor's blog</a> by <a href="./pages/about.html">vdmitriyev</a>. Powered by <a href="http://getpelican.com">Pelican</a>, <a href="http://python.org">Python</a>, <a href="https://getbootstrap.com">Bootstrap 4</a><br>
            <!-- Do not remove below license sentence -->
            License: <a href="https://spdx.org/licenses/CC-BY-4.0.html">CC-BY-4.0</a>, based on <a href="https://github.com/vuquangtrong/simplify-theme">Simplify Bootstrap Theme</a>
        </div>
    </footer>

    <!-- Scripts -->
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
    -->
    <script type="text/javascript" src="./theme/jquery/jquery-3.4.1.min.js"></script>
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/bootstrap.min.js"></script>
    -->
    <script type="text/javascript" src="./theme/bootstrap/bootstrap.min.js"></script>
    <!--
    <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
    -->
    <script type="text/javascript" src="./theme/style.js"></script>

    <!-- Sharing -->

    <!-- JSON LD -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "name": "Hadoop Streaming and XML with Python",
    "headline": "Hadoop Streaming and XML with Python",
    "datePublished": "2016-03-03 18:00:00+01:00",
    "dateModified": "",
    "author": {
        "@type": "Person",
        "name": "vdmitriyev",
        "url": "./author/vdmitriyev.html"
    },
    "image": "./favicon.ico",
    "url": "./hadoop-streaming-and-xml-with-python.html",
    "description": ""
}
</script>
    <!-- Disqus count -->
</body>

</html>